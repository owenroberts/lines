class UIElement{constructor(e){e=e||{},this.el=document.getElementById(e.id)?document.getElementById(e.id):document.createElement(e.tag||"div");for(const t in e.css)this.el.style[t]=e.css[t];void 0!==e.id&&(this.el.id=e.id),e.class&&this.addClass(e.class)}set text(e){this.el.textContent=e}set value(e){this.el.value=e}get value(){return this.el.value}get position(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}setProp(e,t){this.el.style.setProperty(e,t)}getProp(e){return this.el.style.getPropertyValue(e)}handler(){this.callback()}addClass(e){this.el.classList.add(e)}removeClass(e){this.el.classList.remove(e)}setKey(e,t){this.el.title=`${t||""} ~ ${e}`,this.el.addEventListener("mouseenter",this.onPress.bind(this)),this.el.addEventListener("mouseleave",this.onRelease.bind(this))}onPress(e){toolTip.text=""+this.el.title,toolTip.addClass("visible"),this.addClass("triggered"),!0===e&&setTimeout(this.onRelease.bind(this),400)}onRelease(){toolTip.removeClass("visible"),this.removeClass("triggered")}remove(){this.el.remove()}}class UICollection extends UIElement{constructor(e){super(e)}append(e,t){void 0!==t&&(this[t]=e),Array.isArray(e.html)?e.html.forEach(e=>{this.el.appendChild(e)}):this.el.appendChild(e.el)}remove(e,t){t&&delete this[t],this.el.removeChild(e.el)}removeK(e){this.el.removeChild(this[e].el),delete this[e]}clear(){for(let e=this.el.children.length-1;e>=0;--e)this.el.children[e].remove()}}class UIInput extends UIElement{constructor(e){e.tag="input",super(e),this.callback=e.callback,this.arguments=e.arguments,e.key&&this.setKey(e.key,e.label)}}class UIText extends UIInput{constructor(e){super(e),this.el.type="text",this.placeholder=this.el.placeholder||e.placeholder||e.text||e.value,this.el.placeholder=this.placeholder,this.el.addEventListener("focus",e=>{this.el.select()}),this.el.addEventListener("keyup",t=>{e.updateByKey&&this.callback(t.target.value)}),this.el.addEventListener("keyup",e=>{13==e.which&&this.update(e.target.value)}),this.el.addEventListener("blur",e=>{this.value?this.value!==e.target.value&&(this.el.value=this.value):(this.el.placeholder=this.placeholder,this.el.value="")})}handler(e){this.update(void 0!==e?+e:prompt(this.prompt))}update(e,t){this.callback&&!t&&this.callback(e),this.value=e}set value(e){this._value=e,this.el.placeholder=e,this.el.blur()}get value(){return this._value}}class UIBlur extends UIText{constructor(e){super(e),this.el.addEventListener("blur",e=>{e.target.value&&this.handler(e.target.value)}),this.value=e.value}set value(e){this.arguments&&this.arguments.segmentNum&&(console.trace(),console.log(e)),void 0!==e&&(this.el.placeholder=e),this.el.value="",this.el.blur()}get value(){return this.el.value||this.el.placeholder}}class UIButton extends UIElement{constructor(e){e.tag="span",super(e),this.addClass(e.type||"btn"),this.text=this.el.textContent||e.text||e.onText,this.callback=e.callback,this.arguments=e.arguments||[],this.el.addEventListener("click",this.handler.bind(this)),e.key&&this.setKey(e.key,""+this.el.textContent)}handler(){this.callback(...this.arguments)}}class UIColor extends UIInput{constructor(e){super(e),this.el.type="color",this.colors=[],this.arguments=e.arguments||[],this.el.addEventListener("input",e=>{this.setColor(e.target.value)}),this.el.addEventListener("focus",e=>{this.addColor(this.current)}),this.palette=new UICollection}addColor(e){const t=this;if(!this.colors.includes(e)&&e){this.colors.push(e);const s=new UIButton({text:e,css:{background:e},value:e,callback:function(){t.update(e)}});t.palette.append(s)}}setColor(e){this.current=e,this.callback(...this.arguments,e)}update(e,t){t||this.setColor(e),this.value=e}set value(e){this.addColor(e),this.current=e,super.value=e}get value(){return this.el.value}get html(){return[this.el,this.palette.el]}}class UIDragButton extends UIButton{constructor(e){super(e),this.down={x:0,y:0},this.el.addEventListener("mousemove",e=>{this.down.x&&(this.dragging=!0)}),this.el.addEventListener("mousedown",e=>{this.down.x=e.pageX}),document.addEventListener("mouseup",e=>{if(this.dragging){const t=e.pageX-this.down.x;Math.abs(t)>10&&this.callback(t>0?1:-1,Math.abs(Math.ceil(t/lns.ui.timeline.frameWidth)))}this.dragging=!1,this.down.x=0})}}class UILabel extends UIElement{constructor(e){e.tag="label",super(e),this.text=e.text}}class UIList extends UICollection{constructor(e){super(e)}insertBefore(e,t){this.el.insertBefore(e.el,t.el)}get length(){return this.el.children.length}get children(){return this.el.children}addClass(e){for(let t=0;t<this.els.length;t++)this.els[t].classList.contains(e)||this.els[t].classList.add(e)}setId(e,t){this.children[t].id=e}removeIndex(e){this.children[e].remove()}looper(e,t,s){const l=s||this.length-2;for(let s=t||0;s<=l;s++)e(this.children[s])}}class UIModal extends UICollection{constructor(e,t,s,l){super({}),this.addClass("modal"),this.append(new UILabel({text:e})),this.el.style.left=Math.max(0,s.x-100)+"px",this.el.style.top=Math.max(0,s.y-20)+"px",document.getElementById("container").appendChild(this.el);const n=this;this.break=new UIElement({class:"break"}),this.append(this.break),this.submit=new UIButton({text:"Submit",callback:function(){l&&l(),n.clear()}}),this.append(this.submit),t.ui.keys.enter=this.submit,this.cancel=new UIButton({text:"x",callback:e=>{this.clear()}}),t.ui.keys.escape=this.cancel,this.append(this.cancel)}add(e){this.el.insertBefore(e.el,this.break.el)}addBreak(e){this.add(new UIElement({class:"break"})),e&&this.addLabel(e)}addLabel(e){this.add(new UILabel({text:e}))}clear(){this.el.remove()}}class UIPanel extends UICollection{constructor(e,t){super({id:e+"-panel"}),this.addClass("panel"),this.addClass("undocked"),this.rows=[],this.header=new UIRow,this.header.addClass("header"),this.append(this.header),this.open=new UIToggle({onText:"－",offText:"＋",type:"toggle",callback:()=>{this.open.isOn?this.addClass("closed"):this.removeClass("closed")}}),this.header.append(this.open),this.header.append(new UILabel({text:t})),this.header.append(new UIButton({text:"X",type:"undock-btn",callback:this.undock.bind(this)})),this.orderBtn=new UIButton({text:this.order||"0",type:"order-btn",callback:()=>{this.order=+this.el.style.order+1,this.orderBtn.text=this.order}}),this.header.append(this.orderBtn),this.header.append(new UIButton({text:"[]",type:"block-btn",callback:()=>{this.el.classList.contains("block")?this.el.classList.remove("block"):this.el.classList.add("block")}})),this.header.append(new UIButton({text:"<",type:"headless-btn",callback:()=>{this.el.classList.contains("headless")?this.el.classList.remove("headless"):this.el.classList.add("headless")}}))}set order(e){this.orderBtn.text=e||"0",this.el.style.order=e}get order(){return this.el.style.order}get isDocked(){return!this.el.classList.contains("undocked")}get isBlock(){return this.el.classList.contains("block")}get isHeadless(){return this.el.classList.contains("headless")}get isOpen(){return this.open.value}block(){this.el.classList.add("block")}headless(){this.el.classList.add("headless")}dock(){this.removeClass("undocked")}undock(){this.addClass("undocked")}addRow(e,t){const s=new UIRow({class:t,id:e});return this.append(s,e),this.rows.push(s),s}removeRow(e){const t=this.rows.indexOf(e);this.rows.splice(t,1),this.remove(e)}add(e,t,s){let l=t||this.rows[this.rows.length-1]||this.addRow();e.prompt,l.append(e,s)}}class UIRange extends UIInput{constructor(e){super(e),this.el.type="range",this.setRange(e.min,e.max),this.value=e.value||e.min,this.arguments=e.arguments||[],e.step&&this.setStep(e.step),this.el.addEventListener(e.event||"input",e=>{this.handler(e.target.value)})}handler(e,t){this.update(t?prompt(this.prompt):+e)}update(e){this.el.value=e,this.el.blur(),this.callback(e)}setRange(e,t){this.el.min=e,this.el.max=t}setStep(e){this.el.step=e}}class UIRow extends UICollection{constructor(e){super(e),this.addClass("row")}clear(){for(const e in this)void 0!==e&&"el"!==e&&delete this[e];for(;this.el.firstChild;)this.el.firstChild.value=null,this.el.removeChild(this.el.firstChild)}}class UISelect extends UIElement{constructor(e){e.tag="select",super(e),this.setOptions(e.options||[],e.selected),this.el.addEventListener("change",(function(t){e.callback&&e.callback(t.target.value),t.target.blur()}))}removeOption(e){for(let t=0;t<this.el.children.length;t++)this.el.children[t].value==e&&this.el.children[t].remove()}addOption(e,t){const s=document.createElement("option");s.value=s.textContent=e,t&&(s.selected="selected"),this.el.appendChild(s)}setOptions(e,t){for(let s=0;s<e.length;s++){Array.from(this.el.options).map(e=>e.value).includes(e[s])||this.addOption(e[s],t==e[s])}}}class UISelectButton extends UICollection{constructor(e){super(e),this.select=new UISelect({options:e.options,callback:function(){}}),this.btn=new UIButton({text:"+",css:{"margin-left":"1px"},callback:()=>{e.callback(this.select.value)}})}get html(){return[this.select.el,this.btn.el]}}class UITextRange extends UICollection{constructor(e){super(e),this.callback=e.callback,this.arguments=e.arguments||[],this.textInput=new UIBlur({...e,callback:this.handler.bind(this)}),this.range=new UIRange({...e,callback:this.handler.bind(this)}),"change"==e.event&&this.range.el.addEventListener("input",e=>{this.textInput.el.placeholder=e.currentTarget.value})}get html(){return[this.textInput.el,this.range.el]}handler(e,t){t||this.update(void 0!==e?+e:prompt(this.prompt)),this.value=e}update(e,t){t||this.callback(...this.arguments,e),this.value=e}set value(e){this.textInput.value=e,this.range.value=e}get value(){return this.textInput.value}}class UIToggle extends UIButton{constructor(e){super(e),this.onText=e.onText||e.text,this.offText=e.offText||e.text,this.arguments=e.arguments||[],super.text=this.onText,this.isOn=!0,!1===e.isOn&&this.toggle()}update(e,t){e||(t||this.callback(),this.toggle())}handler(){this.callback(...this.arguments,this.value),this.toggle()}toggle(){this.isOn?this.off():this.on(),this.isOn=!this.isOn}on(){this.text=this.onText,this.removeClass("off")}off(){this.text=this.offText,this.addClass("off")}get value(){return this.isOn}}function Interface(e){const t=this,s={UILabel:UILabel,UIElement:UIElement,UIRange:UIRange,UIText:UIText,UIBlur:UIBlur,UITextRange:UITextRange,UIToggle:UIToggle,UIButton:UIButton,UIColor:UIColor,UISelect:UISelect,UISelectButton:UISelectButton,UICollection:UICollection,UIList:UIList,UIRow:UIRow,UIInput:UIInput};document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop"),this.keys={},this.faces={},this.panels=new UICollection({id:"panels"}),this.keyDown=function(e){let s=Cool.keys[e.which];"space"==s&&e.preventDefault(),s=e.shiftKey?"shift-"+s:s,s=e.ctrlKey?"ctrl-"+s:s,s=e.altKey?"alt-"+s:s;const l=t.keys[s];s&&l&&"text"!=document.activeElement.type&&!e.metaKey&&(e.preventDefault(),l.handler(e.target.value,!0),l.onPress(!0))},document.addEventListener("keydown",t.keyDown,!1),window.toolTip=new UILabel({id:"tool-tip"}),document.getElementById("interface").appendChild(window.toolTip.el),this.load=function(e,s){fetch(e).then(e=>e.json()).then(e=>{t.addQuickRef(e);for(const s in e)t.createPanel(s,e[s]);t.addSelect([...Object.keys(e),"quickRef"]),s&&s()})},this.addQuickRef=function(s){const l=new UIPanel("quickRef","Quick Ref");l.fontSize=11,l.list=[],t.panels.append(l,"quickRef"),l.add(new UILabel({text:"Scale"}));const n=new UIText({placeholder:11,min:10,max:40,callback:function(e){l.fontSize=+e,document.body.style.setProperty("--quick-ref-font-size",l.fontSize)}});l.add(n),t.faces.quickRefScale=n,l.add(new UIButton({text:"+",callback:function(){const n=new UIModal("panels",e,l.position,(function(){const a={};if(s[i.value].uis.forEach(e=>{e.list.forEach(t=>{let s=!(!t.number&&!t.toggle);if(t.fromModule&&(s=!!t.fromModule.callback),s){const s=t.params?t.params.text||t.params.onText||t.params.label||t.face:t.fromModule.callback;t.mod=e.module,t.sub=e.sub,a[s]=t}})}),Object.keys(a).length>0){const s=new UIModal("ui",e,l.position,(function(){const e=a[n.value];t.createUI(e,e.mod,e.sub,l);l.list.push(e)})),n=new UISelect({options:Object.keys(a)});s.add(n);const i=new UIButton({text:"Execute",callback:function(){s.clear();const t=a[n.value];console.log(t);const l=t.sub?e[t.mod][t.sub]:e[t.mod];t.fromModule&&t.fromModule.callback&&l[t.fromModule.callback](),t.number&&(l[t.number]=+prompt(t.prompt||t.label)),t.toggle&&(l[t.toggle]=!l[t.toggle])}});s.add(i)}else n.clear()})),i=new UISelect({options:Object.keys(s)});n.add(i)}}))},this.addSelect=function(e){new UICollection({id:"selector"}).append(new UISelectButton({options:e,callback:function(e){t.panels[e].dock()},btn:"+"}))},this.createPanel=function(s,l){const n=new UIPanel(s,l.label);this.panels.append(n,s);for(let s=0;s<l.uis.length;s++){const i=l.uis[s];for(let e=0;e<i.list.length;e++)t.createUI(i.list[e],i.module,i.sub,n);"ui"==i.module&&i.sub&&(e.ui[i.sub].panel=n)}},this.createUI=function(l,n,i,a){const o=i?e[n][i]:e[n],c={...l.params};l.key&&(c.key=l.key);for(const e in l.fromModule)c[e]=o[l.fromModule[e]];l.number&&(c.callback=function(e){o[l.number]=+e}),l.toggle&&(c.callback=function(){o[l.toggle]=!o[l.toggle]}),l.row&&a.addRow(),l.label&&a.add(new UILabel({text:l.label}));let r=new s[l.type](c);"UIRow"==l.type?a.addRow(l.k,c.class):l.k?a.append(r,l.k):a.add(r),c.prompt&&(r.prompt=c.prompt),c.key&&(t.keys[l.key]=r),l.face&&(t.faces[l.face]=r)};const l=document.getElementById("interface"),n=document.createElement("div");n.id="resize";let i=!1,a=l.clientWidth,o=0;n.textContent="|||",l.appendChild(n),n.addEventListener("mousedown",e=>{i=!0,o=e.pageX}),document.addEventListener("mouseup",e=>{i&&(i=!1,a=+l.style.maxWidth.replace("px",""))}),document.addEventListener("mousemove",e=>{if(i){const t=e.pageX-o;l.style.maxWidth=a+t+"px"}})}function Settings(e,t,s){const l=this;this.name="settings-"+t,this.save=function(){const t=s?{...s()}:{};t.panels={};for(const s in e.ui.panels)"el"!=s&&(t.panels[s]={open:e.ui.panels[s].isOpen,docked:e.ui.panels[s].isDocked,order:e.ui.panels[s].order,block:e.ui.panels[s].isBlock,headless:e.ui.panels[s].isHeadless});localStorage[l.name]=JSON.stringify(t)},this.load=function(t){if(localStorage[l.name]){const s=JSON.parse(localStorage[l.name]);t&&t(s);for(const t in s.panels)"el"!=t&&(s.panels[t].docked&&e.ui.panels[t].dock(),s.panels[t].open||e.ui.panels[t].open.update(),s.panels[t].block&&e.ui.panels[t].block(),s.panels[t].headless&&e.ui.panels[t].headless(),e.ui.panels[t].order=s.panels[t].order)}},this.clear=function(){delete localStorage[l.name]},this.toggleSaveSettings=function(){e.files.saveSettingsOnUnload=!e.files.saveSettingsOnUnload}}
//# sourceMappingURL=src_maps/interface.min.js.map
