class UIElement{constructor(e){e=e||{},this.el=document.getElementById(e.id)?document.getElementById(e.id):document.createElement(e.tag||"div");for(const t in e.css)this.el.style[t]=e.css[t];void 0!==e.id&&(this.el.id=e.id),e.class&&this.addClass(e.class)}set text(e){this.el.textContent=e}set value(e){this.el.value=e}get value(){return this.el.value}get position(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}setProp(e,t){this.el.style.setProperty(e,t)}getProp(e){return this.el.style.getPropertyValue(e)}keyHandler(){this.callback()}addClass(e){this.el.classList.add(e)}removeClass(e){this.el.classList.remove(e)}setKey(e,t){this.el.title=`${t||""} ~ ${e}`,this.el.addEventListener("mouseenter",this.onPress.bind(this)),this.el.addEventListener("mouseleave",this.onRelease.bind(this))}onPress(e){toolTip.text=`${this.el.title}`,toolTip.addClass("visible"),this.addClass("triggered"),!0===e&&setTimeout(this.onRelease.bind(this),400)}onRelease(){toolTip.removeClass("visible"),this.removeClass("triggered")}remove(){this.el.remove()}}class UICollection extends UIElement{constructor(e){super(e)}append(e,t){void 0!==t&&(this[t]=e),Array.isArray(e.html)?e.html.forEach((e=>{this.el.appendChild(e)})):this.el.appendChild(e.el)}remove(e,t){t&&delete this[t],this.el.removeChild(e.el)}removeK(e){this.el.removeChild(this[e].el),delete this[e]}clear(){for(let e=this.el.children.length-1;e>=0;--e)this.el.children[e].remove()}get uiList(){return Object.keys(this).filter((e=>"el"!==e)).map((e=>this[e]))}}class UIInput extends UIElement{constructor(e){e.tag="input",super(e),this.callback=e.callback,this.args=e.args||[],e.key&&this.setKey(e.key,e.label)}}class UIText extends UIInput{constructor(e){super(e),this.el.type="text",this.placeholder=this.el.placeholder||e.placeholder||e.text||e.value||"",this.el.placeholder=this.placeholder,this.el.addEventListener("focus",(e=>{this.el.select()})),this.el.addEventListener("keyup",(e=>{13==e.which&&(this.update(e.target.value),this.el.blur())})),this.el.addEventListener("blur",(e=>{this.value?this.value!=e.target.value&&e.target.value&&this.update(e.target.value):(this.el.placeholder=this.placeholder,this.el.value="")}))}keyHandler(e){this.update(prompt(this.prompt))}update(e,t){this.value=e,this.callback&&!t&&this.callback(e)}set value(e){this._value=e,this.placeholder=e,this.el.placeholder=e,this.el.value=""}get value(){return this._value||this.placeholder}}function Interface(e){const t=this,s={UILabel:UILabel,UIElement:UIElement,UIRange:UIRange,UIText:UIText,UINumber:UINumber,UINumberRange:UINumberRange,UINumberStep:UINumberStep,UIToggle:UIToggle,UIToggleCheck:UIToggleCheck,UIButton:UIButton,UIColor:UIColor,UISelect:UISelect,UISelectButton:UISelectButton,UICollection:UICollection,UIList:UIList,UIRow:UIRow,UIInput:UIInput};document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop"),this.keys={},this.faces={},this.panels=new UICollection({id:"panels"}),this.quickRef=new QuickRef(e),this.maxPanels=100,this.maxWidth=500,this.useMaxWidth=!1,this.panels.append(new UIElement({id:"panel-break"})),this.keyDown=function(e){let s=Cool.keys[e.which];"space"===s&&e.preventDefault(),s=e.shiftKey?"shift-"+s:s,s=e.ctrlKey?"ctrl-"+s:s,s=e.altKey?"alt-"+s:s;const l=t.keys[s];s&&l&&"text"!==document.activeElement.type&&"number"!==document.activeElement.type&&!e.metaKey&&(e.preventDefault(),l.keyHandler(e.target.value),l.onPress(!0))},document.addEventListener("keydown",t.keyDown,!1),window.toolTip=new UILabel({id:"tool-tip"}),document.getElementById("interface").appendChild(window.toolTip.el),this.load=function(e,s){!async function(e,s){const l=await fetch(e).then((e=>e.json())),i={...await fetch("../interface/interface.json").then((e=>e.json())),...l};for(const e in i)t.createPanel(e,i[e]);t.addSelect([...Object.keys(i).map((e=>[e,i[e].label]))]),t.quickRef.addData(i),s&&s()}(e,s)},this.addSelect=function(e){const s=new UICollection({id:"selector"}),l=new UISelectButton({callback:function(e){t.panels[e].dock()},btn:"+"});e.forEach((e=>{const[t,s]=e;l.select.addOption(t,!1,s)})),s.append(l)},this.createPanel=function(s,l){const i=new UIPanel({id:s,label:l.label,onToggle:function(){lns.ui.panels.uiList.filter((e=>e.isOpen&&e.isDocked))}});this.panels.append(i,s);for(let s=0;s<l.uis.length;s++){const a=l.uis[s];for(let e=0;e<a.list.length;e++)t.createUI(a.list[e],a.module,a.sub,i);"ui"==a.module&&a.sub&&(e.ui[a.sub].panel=i)}},this.createUI=function(l,i,a,n){const o=a?e[i][a]:e[i],c={...l.params};l.key&&(c.key=l.key);for(const e in l.fromModule)c[e]=o[l.fromModule[e]];l.number&&(c.callback=function(e){o[l.number]=+e}),l.toggle&&(c.callback=function(e){o[l.toggle]=void 0!==e?e:!o[l.toggle]}),l.row&&n.addRow(),l.label&&n.add(new UILabel({text:l.label}));let h=new s[l.type](c);"UIRow"==l.type?n.addRow(l.k,c.class):l.k?n.append(h,l.k):n.add(h),c.prompt&&(h.prompt=c.prompt),c.key&&(t.keys[l.key]=h),l.face&&(t.faces[l.face]=h)},this.toggleMaxWidth=function(e){t.useMaxWidth=e,t.useMaxWidth?l.classList.add("max-width"):l.classList.remove("max-width")},this.setMaxWidth=function(e){t.maxWidth=+e,l.style.setProperty("--max-width",t.maxWidth)};const l=document.getElementById("interface"),i=document.createElement("div");t.maxWidth=l.clientWidth,i.id="resize";let a=!1;function n(e){a&&(a=!1,document.removeEventListener("mouseup",n),document.removeEventListener("mousemove",o))}function o(e){a&&t.useMaxWidth&&(t.maxWidth+=e.movementX,l.style.setProperty("--max-width",t.maxWidth),lns.ui.faces.maxWidthDisplay.value=t.maxWidth,t.maxWidth>l.clientWidth&&(t.maxWidth=l.clientWidth))}i.textContent="|||",l.appendChild(i),i.addEventListener("mousedown",(function(e){a=!0,document.addEventListener("mouseup",n),document.addEventListener("mousemove",o)}))}function QuickRef(e){const t=this,s={};this.fontSize=11,this.list=[],this.setScale=function(e){t.fontSize=+e,document.body.style.setProperty("--quick-ref-font-size",+e)},this.reset=function(){lns.ui.faces.quickRefScale.update(11)},this.addRef=function(){const l=new UIModal({title:"panels",app:e,position:t.panel.position,callback:function(){const a={};if(s[i.value].uis.forEach((e=>{e.list.forEach((t=>{let s=!(!t.number&&!t.toggle);if(t.fromModule&&(s=!!t.fromModule.callback),s){const s=t.params?t.params.text||t.params.onText||t.params.label||t.face:t.fromModule.callback;t.mod=e.module,t.sub=e.sub,a[s]=t}}))})),Object.keys(a).length>0){const s=new UIModal({title:"ui",app:e,position:t.panel.position,callback:function(){const s=a[l.value];e.ui.createUI(s,s.mod,s.sub,t.panel);t.list.push(s)}}),l=new UISelect({options:Object.keys(a)});s.add(l);const i=new UIButton({text:"Execute",callback:function(){s.clear();const t=a[l.value];console.log(t);const i=t.sub?e[t.mod][t.sub]:e[t.mod];t.fromModule&&t.fromModule.callback&&i[t.fromModule.callback](),t.number&&(i[t.number]=+prompt(t.prompt||t.label)),t.toggle&&(i[t.toggle]=!i[t.toggle])}});s.add(i)}else l.clear()}}),i=new UISelect({options:Object.keys(s)});l.add(i)},this.addData=function(e){for(const t in e)s[t]=e[t]}}function Settings(e,t,s){const l=this;this.name=`settings-${t}`,this.save=function(){const t=s?{...s()}:{};t.panels={};for(const s in e.ui.panels)"el"!=s&&(t.panels[s]={open:e.ui.panels[s].isOpen,docked:e.ui.panels[s].isDocked,order:e.ui.panels[s].order,block:e.ui.panels[s].isBlock,headless:e.ui.panels[s].isHeadless});localStorage[l.name]=JSON.stringify(t)},this.load=function(t){if(localStorage[l.name]){const s=JSON.parse(localStorage[l.name]);t&&t(s);for(const t in s.panels)"el"!==t&&(s.panels[t].docked&&e.ui.panels[t].dock(),s.panels[t].open||e.ui.panels[t].open.update(),s.panels[t].block&&e.ui.panels[t].block(),s.panels[t].headless&&e.ui.panels[t].headless(),e.ui.panels[t].order=s.panels[t].order)}},this.clear=function(){delete localStorage[l.name]},this.toggleSaveSettings=function(){e.files.saveSettingsOnUnload=!e.files.saveSettingsOnUnload}}class UIButton extends UIElement{constructor(e){e.tag="span",super(e),this.addClass(e.type||"btn"),this.text=this.el.textContent||e.text||e.onText,this.callback=e.callback,this.args=e.args||[],this.el.addEventListener("click",this.keyHandler.bind(this)),e.key&&this.setKey(e.key,`${this.el.textContent}`)}keyHandler(){this.callback(...this.args)}}class UIColor extends UIInput{constructor(e){super(e),this.el.type="color",this.colors=[],this.args=e.args||[],this.el.addEventListener("input",(e=>{this.setColor(e.target.value)})),this.el.addEventListener("focus",(e=>{this.addColor(this.current)})),this.palette=new UICollection}addColor(e){const t=this;if(!this.colors.includes(e)&&e){this.colors.push(e);const s=new UIButton({text:e,css:{background:e},value:e,callback:function(){t.update(e)}});t.palette.append(s)}}setColor(e){this.current=e,this.callback(...this.args,e)}update(e,t){t||this.setColor(e),this.value=e}set value(e){this.addColor(e),this.current=e,super.value=e}get value(){return this.el.value}get html(){return[this.el,this.palette.el]}}class UIDragButton extends UIButton{constructor(e){super(e),this.down={x:0,y:0},this.el.addEventListener("mousemove",(e=>{this.down.x&&(this.dragging=!0)})),this.el.addEventListener("mousedown",(e=>{this.down.x=e.pageX})),document.addEventListener("mouseup",(e=>{if(this.dragging){const t=e.pageX-this.down.x;Math.abs(t)>10&&this.callback(t>0?1:-1,Math.abs(Math.ceil(t/lns.ui.timeline.frameWidth)))}this.dragging=!1,this.down.x=0}))}}class UILabel extends UIElement{constructor(e){e.tag="label",super(e),this.text=e.text}}class UIList extends UICollection{constructor(e){super(e)}insertBefore(e,t){this.el.insertBefore(e.el,t.el)}get length(){return this.el.children.length}get children(){return this.el.children}addClass(e){for(let t=0;t<this.els.length;t++)this.els[t].classList.contains(e)||this.els[t].classList.add(e)}setId(e,t){this.children[t].id=e}removeIndex(e){this.children[e].remove()}looper(e,t,s){const l=s||this.length-2;for(let s=t||0;s<=l;s++)e(this.children[s])}}class UIModal extends UICollection{constructor(e){super({}),this.addClass("modal"),this.append(new UILabel({text:e.title})),document.getElementById("container").appendChild(this.el);const t=this;this.break=new UIElement({class:"break"}),this.append(this.break),this.submit=new UIButton({text:"Submit",callback:function(){e.callback&&e.callback(),t.clear()}}),this.append(this.submit),e.app.ui.keys.enter=this.submit,this.cancel=new UIButton({text:"x",callback:t=>{this.clear(),e.onClear&&e.onClear()}}),e.app.ui.keys.escape=this.cancel,this.append(this.cancel);let s=Math.max(16,e.position.x-100),l=Math.max(16,e.position.y-20);this.el.style.left=`${s}px`,this.el.style.top=`${l}px`}adjustPosition(){let e=parseInt(this.el.style.left),t=parseInt(this.el.style.top),s=parseInt(this.el.offsetWidth),l=parseInt(this.el.offsetHeight);e+s>window.innerWidth&&(this.el.style.left=e-s+"px"),t+l>window.innerHeight&&(this.el.style.top=t-l+"px")}add(e){this.el.insertBefore(e.el,this.break.el)}addBreak(e){this.add(new UIElement({class:"break"})),e&&this.addLabel(e)}addLabel(e){this.add(new UILabel({text:e}))}clear(){this.el.remove()}}class UINumber extends UIText{constructor(e){super(e),this.el.classList.add("number")}update(value,uiOnly){if(void 0!==value){if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(e){return void alert("Please enter a numerical value or mathematical expression.")}this.value=value,this.callback&&!uiOnly&&this.callback(value)}}keyHandler(e){this.update(+prompt(this.prompt))}}class UINumberRange extends UICollection{constructor(e){super(e),this.callback=e.callback,this.args=e.args||[],this.numberInput=new UINumber({...e,callback:this.update.bind(this)}),this.range=new UIRange({...e,callback:this.update.bind(this)}),"change"===e.event&&this.range.el.addEventListener("input",(e=>{this.numberInput.el.placeholder=e.currentTarget.value}))}get html(){return[this.numberInput.el,this.range.el]}keyHandler(e,t){this.update(+prompt(this.prompt))}update(e,t){t||this.callback(e,...this.args),this.value=e}set value(e){this.numberInput.value=e,this.range.value=e}get value(){return this.numberInput.value}}class UINumberStep extends UICollection{constructor(e){super(e),this.callback=e.callback,this.args=e.args,this.step=+e.step||1,this.min=+e.min||0,this.max=+e.max||100,this.addClass("ui-collection"),this.numberInput=new UINumber({...e,class:"middle",callback:this.update.bind(this)}),this.stepDown=new UIButton({text:"<",class:"left-end",callback:()=>{this.update(this.value-this.step)}}),this.stepUp=new UIButton({text:">",class:"right-end",callback:()=>{this.update(this.value+this.step)}}),this.append(this.stepDown),this.append(this.numberInput),this.append(this.stepUp);const t={x:0,y:0,lock:"none",timeout:8,timer:0,prev:0,active:!1},s=this;function l(e){if(!t.active)return;const l={x:e.pageX-t.x,y:e.pageY-t.y};if("none"===t.lock&&(t.lock=Math.abs(l.x)>Math.abs(l.y)?"x":"y"),Math.abs(l[t.lock])>10&&0===t.timer){const i="x"===t.lock?1:-1;s.update(s.value+s.step*i*Math.sign(l[t.lock])),t.timer=t.timeout,t.x=e.pageX,t.y=e.pageY}else t.timer>0&&t.timer--}function i(e){t.active&&(t.active=!1,t.x=0,t.y=0,t.lock="none",t.dir=0,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",i))}this.numberInput.el.addEventListener("mousedown",(function(e){t.x=e.pageX,t.y=e.pageY,t.active=!0,document.addEventListener("mousemove",l),document.addEventListener("mouseup",i)}))}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){e<this.min||e>this.max||(t||(this.args?this.callback(e,...this.args):this.callback(e)),this.value=e)}get html(){return this.el}set value(e){this.numberInput.value=+e}get value(){return this.numberInput.value}}class UIPanel extends UICollection{constructor(e){super({id:`${e.id}-panel`}),this.addClass("panel"),this.addClass("undocked"),this.rows=[],this.header=new UIRow,this.header.addClass("header"),this.append(this.header),this.open=new UIToggle({onText:"－",offText:"＋",type:"toggle",callback:()=>{e.onToggle&&e.onToggle(),this.open.isOn?this.addClass("closed"):this.removeClass("closed")}}),this.header.append(this.open),this.header.append(new UILabel({text:e.label})),this.header.append(new UIButton({text:"X",type:"undock-btn",callback:this.undock.bind(this)})),this.orderBtn=new UIButton({text:this.order||"0",type:"order-btn",callback:()=>{this.order=+this.el.style.order+1,this.orderBtn.text=this.order}}),this.header.append(this.orderBtn),this.header.append(new UIButton({text:"[]",type:"block-btn",callback:()=>{this.el.classList.contains("block")?this.el.classList.remove("block"):this.el.classList.add("block")}})),this.header.append(new UIButton({text:"<",type:"headless-btn",callback:()=>{this.el.classList.contains("headless")?this.el.classList.remove("headless"):this.el.classList.add("headless")}}))}set order(e){this.orderBtn.text=e||"0",this.el.style.order=e}get order(){return this.el.style.order}get isDocked(){return!this.el.classList.contains("undocked")}get isBlock(){return this.el.classList.contains("block")}get isHeadless(){return this.el.classList.contains("headless")}get isOpen(){return this.open.value}block(){this.el.classList.add("block")}headless(){this.el.classList.add("headless")}dock(){this.removeClass("undocked")}undock(){this.addClass("undocked")}addRow(e,t){const s=new UIRow({class:t,id:e});return this.append(s,e),this.rows.push(s),s}removeRow(e){const t=this.rows.indexOf(e);this.rows.splice(t,1),this.remove(e)}add(e,t,s){let l=t||this.rows[this.rows.length-1]||this.addRow();e.prompt,l.append(e,s)}}class UIRange extends UIInput{constructor(e){super(e),this.el.type="range",this.setRange(e.min,e.max),this.value=e.value||e.min,e.step&&this.setStep(e.step),this.el.addEventListener(e.event||"input",(e=>{this.update(e.target.value)}))}keyHandler(e){this.update(+prompt(this.prompt))}update(e){this.el.value=e,this.el.blur(),this.callback(e)}setRange(e,t){this.el.min=e,this.el.max=t}setStep(e){this.el.step=e}}class UIRow extends UICollection{constructor(e){super(e),this.addClass("row")}clear(){for(const e in this)void 0!==e&&"el"!==e&&delete this[e];for(;this.el.firstChild;)this.el.firstChild.value=null,this.el.removeChild(this.el.firstChild)}}class UISelect extends UIElement{constructor(e){e.tag="select",super(e),this.setOptions(e.options||[],e.selected),this.el.addEventListener("change",(function(t){e.callback&&e.callback(t.target.value),t.target.blur()}))}removeOption(e){for(let t=0;t<this.el.children.length;t++)this.el.children[t].value==e&&this.el.children[t].remove()}addOption(e,t,s){const l=document.createElement("option");l.value=l.textContent=e,t&&(l.selected="selected"),s&&(l.textContent=s),this.el.appendChild(l)}setOptions(e,t){for(let s=0;s<e.length;s++){Array.from(this.el.options).map((e=>e.value)).includes(e[s])||this.addOption(e[s],t==e[s])}}}class UISelectButton extends UICollection{constructor(e){super(e),this.select=new UISelect({options:e.options,callback:function(){}}),this.btn=new UIButton({text:"+",css:{"margin-left":"1px"},callback:()=>{e.callback(this.select.value)}})}get html(){return[this.select.el,this.btn.el]}}class UIToggle extends UIButton{constructor(e){super(e),this.onText=e.onText||e.text,this.offText=e.offText||e.text,super.text=this.onText,this.isOn=!0,!1===e.isOn&&this.toggle(),this.addClass("toggle")}update(e,t){e!==this.isOn&&(t||this.callback(e),this.toggle())}keyHandler(){this.callback(this.value),this.toggle()}toggle(){this.isOn?this.off():this.on(),this.isOn=!this.isOn}on(){this.text=this.onText,this.removeClass("off")}off(){this.text=this.offText,this.addClass("off")}get value(){return this.isOn}}class UIToggleCheck extends UICollection{constructor(e){super(e),this.callback=e.callback,this.check=new UIElement({tag:"input",text:e.text,class:"toggle-check"}),this.check.el.type="checkbox",this.check.el.addEventListener("change",(e=>{this.callback&&this.callback(e.target.checked)})),this.label=new UIElement({tag:"label"}),this.label.text=e.text}get html(){return[this.label.el,this.check.el]}get value(){return this.check.el.checked}keyHandler(e){this.update(void 0!==e?e:!this.value)}update(e){this.check.el.checked=e,this.callback&&this.callback(e)}}
//# sourceMappingURL=src_maps/interface.min.js.map
