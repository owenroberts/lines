function Background(){const e=this;this.show=!0,this.img=new Image,this.x=0,this.y=0,this.width=0,this.height=0,this.size=1,this.rotation=0,this.loadImage=function(n){e.img.src=n,e.img.onload=function(){e.width=e.img.width,e.height=e.img.height}},this.toggle=function(){e.show=!e.show},this.display=function(){this.img.src&&this.show&&(this.rotation>0&&(lns.canvas.ctx.save(),lns.canvas.ctx.rotate(this.rotation*Math.PI/180)),lns.canvas.ctx.drawImage(this.img,this.x,this.y,this.size*this.width,this.height*this.size),this.rotation>0&&lns.canvas.ctx.restore())}}function Canvas(e,n,t,a,s){const i=this;this.canvas=document.getElementById(e),this.dpr=s&&window.devicePixelRatio||1,this.scale=1,this.ctx=this.canvas.getContext("2d"),this.ctx.miterLimit=1,this.lineWidth=1,this.setBGColor=function(e){i.bgColor=e,i.canvas.style.backgroundColor=e},this.setBGColor(a),this.setLineWidth=function(e){i.ctx.lineWidth=i.lineWidth=+e,i.ctx.miterLimit=1},this.setScale=function(e){i.scale=+e,i.setWidth(i.width),i.setHeight(i.height)},this.setWidth=function(e){i.width=+e,i.canvas.width=+e*i.dpr*i.scale,i.reset()},this.setHeight=function(e){i.height=+e,i.canvas.height=+e*i.dpr*i.scale,i.reset()},this.reset=function(){i.ctx.scale(1,1),i.ctx.scale(this.dpr*i.scale,i.dpr*i.scale),i.canvas.style.zoom=1/i.dpr,i.ctx.lineWidth=i.lineWidth,i.ctx.miterLimit=1},this.setWidth(n),this.setHeight(t),this.fitCanvasToDrawing=function(){lns.draw.reset();let e=0,n={x:1e4,y:1e4},t={x:0,y:0};for(let a=0;a<lns.anim.layers.length;a++){const s=lns.anim.layers[a],i=lns.anim.drawings[s.drawingIndex];for(let a=0;a<i.length;a++){const l=i.get(a);"end"!=l&&(e=Math.max(e,4*s.jiggleRange),n.x=Math.min(n.x,l.x+s.x),n.y=Math.min(n.y,l.y+s.y),t.x=Math.max(t.x,l.x+s.x),t.y=Math.max(t.y,l.y+s.y))}}lns.ui.faces.width.update(Math.round(t.x-n.x+2*e)),lns.ui.faces.height.update(Math.round(t.y-n.y+2*e));for(let t=0;t<lns.anim.layers.length-1;t++)lns.anim.layers[t].x-=n.x-e>0?n.x-e:0,lns.anim.layers[t].y-=n.y-e>0?n.y-e:0}}function Data(){const e=this;let n=[],t=[],a=[];this.saveStates={current:{drawings:void 0,layers:void 0},prev:{drawings:void 0,layers:void 0}},this.saveState=function(){e.saveStates.current.drawings?(e.saveStates.prev.drawings=_.cloneDeep(e.saveStates.current.drawings),e.saveStates.prev.layers=_.cloneDeep(e.saveStates.current.layers)):(e.saveStates.prev.drawings=_.cloneDeep(lns.anim.drawings),e.saveStates.prev.layers=_.cloneDeep(lns.anim.layers)),e.saveStates.current.drawings=_.cloneDeep(lns.anim.drawings),e.saveStates.current.layers=_.cloneDeep(lns.anim.layers)},this.undo=function(){e.saveStates.prev.drawings?(lns.anim.drawings=_.cloneDeep(e.saveStates.prev.drawings),lns.anim.layers=_.cloneDeep(e.saveStates.prev.layers),e.saveStates.current.drawings=_.cloneDeep(e.saveStates.prev.drawings),e.saveStates.current.layers=_.cloneDeep(e.saveStates.prev.layers),e.saveStates.prev.drawings=void 0,e.saveStates.prev.layers=void 0):console.log("%c Can't undo ","color:lightblue;background:gray;"),lns.ui.drawings.clear(),lns.ui.update()},this.copy=function(){lns.draw.reset(),n=[];for(let e=0;e<lns.anim.layers.length-1;e++)lns.anim.layers[e].isInFrame(lns.anim.currentFrame)&&n.push(lns.anim.layers[e])},this.paste=function(){e.saveState(),0==a.length&&a.push(lns.anim.currentFrame);for(let e=0;e<a.length;e++)for(let t=0;t<n.length;t++){const s=n[t].addIndex(a[e]);s&&lns.anim.addLayer(s)}a=[],lns.draw.reset(),lns.ui.update()},this.addMultipleCopies=function(){n=[];let t=+prompt("Number of copies: ");if(e.copy(),t)for(let n=0;n<t;n++)lns.ui.play.next(1),e.paste();lns.ui.update()},this.copyRange=function(){const e=+prompt("Start frame:"),n=+prompt("end frame:");t=[];for(let a=e;a<=n;a++){t[a]=[];for(let e=0;e<lns.anim.layers.length-1;e++)lns.anim.layers[e].isInFrame(a)&&t[a].push(lns.anim.layers[e])}},this.pasteRange=function(){for(let e=0;e<t.length;e++){const n=t[e];if(n)for(let e=0;e<n.length;e++){const t=n[e].addIndex(lns.anim.currentFrame);t&&lns.anim.addLayer(t)}lns.ui.play.next(1)}lns.draw.reset(),lns.ui.update()},this.clearLines=function(){lns.draw.drawing=new Drawing},this.clearLayers=function(){e.saveState();for(let e=lns.anim.layers.length-2;e>=0;e--)lns.anim.layers[e].isInFrame(lns.anim.currentFrame)&&(lns.anim.layers[e].removeIndex(lns.anim.currentFrame,(function(){lns.anim.layers.splice(e,1)})),lns.ui.update())},this.cutTopLayer=function(){for(let e=lns.anim.layers.length-2;e>=0;e--){lns.anim.layers[e].isInFrame(lns.anim.currentFrame)&&(lns.anim.layers[e].removeIndex(lns.anim.currentFrame,(function(){lns.anim.layers.splice(e,1)})),lns.ui.update());break}},this.cutBottomLayer=function(){for(let e=0;e<lns.anim.layers.length-1;e++){lns.anim.layers[e].isInFrame(lns.anim.currentFrame)&&(lns.anim.layers[e].removeIndex(lns.anim.currentFrame,(function(){lns.anim.layers.splice(e,1)})),lns.ui.update());break}},this.clearFrame=function(){e.clearLines(),e.clearLayers()},this.deleteFrame=function(n){const t=void 0!==n?n:lns.anim.currentFrame;e.saveState();for(let e=lns.anim.layers.length-2;e>=0;e--)lns.anim.layers[e].removeIndex(lns.anim.currentFrame,(function(){lns.anim.layers.splice(e,1)}));for(let e=lns.anim.layers.length-2;e>=0;e--)lns.anim.layers[e].shiftIndex(t,-1);lns.ui.update()},this.deleteFrameRange=function(){e.saveState();const n=+prompt("Start frame:"),t=+prompt("End frame:");if(t>0){for(let a=t;a>=n;a--)e.deleteFrame(a);lns.draw.cutEnd(),lns.ui.play.setFrame(0)}},this.cutLastSegment=function(){lns.draw.pop()},this.cutLastLine=function(){lns.draw.popOff()},this.insert=function(n){lns.draw.reset(),e.saveState();for(let e=0,t=lns.anim.layers.length-1;e<t;e++)lns.anim.layers[e].shiftIndex(lns.anim.currentFrame+n,1),lns.anim.addLayer(lns.anim.layers[e].removeIndex(lns.anim.currentFrame+n)),lns.anim.frame=lns.anim.currentFrame+n;lns.ui.update()},this.offsetDrawing=function(n){let t=lns.anim.layers.filter(e=>e.isToggled);if(0==t.length&&(t=lns.anim.layers.filter(e=>e.isInFrame(lns.anim.currentFrame))),lns.draw.reset(),t){if(e.saveState(),n||(n=new Cool.Vector(+prompt("x"),+prompt("y"))),n)for(let e=0;e<t.length;e++)t[e].x+=n.x,t[e].y+=n.y}else console.log("%c No layers in frame ","color:yellow; background:black;")},this.quickAnimate=function(e){lns.draw.reset();const n=+prompt("Number of frames?");for(let t=0;t<lns.anim.layers.length-1;t++){const a=lns.anim.layers[t];if(a.isInFrame(lns.anim.currentFrame))switch(a.endFrame=a.startFrame+n,lns.anim.state.end<a.endFrame&&(lns.anim.state.end=a.endFrame),e){case"Draw":a.addTween({prop:"endIndex",startFrame:a.startFrame,endFrame:a.endFrame,startValue:0,endValue:lns.anim.drawings[a.drawingIndex].length});break;case"Reverse":a.addTween({prop:"startIndex",startFrame:a.startFrame,endFrame:a.endFrame,startValue:0,endValue:lns.anim.drawings[a.drawingIndex].length});break;case"DrawReverse":const e=Math.floor(n/2);a.addTween({prop:"endIndex",startFrame:a.startFrame,endFrame:a.startFrame+e,startValue:0,endValue:lns.anim.drawings[a.drawingIndex].length}),a.addTween({prop:"startIndex",startFrame:a.startFrame+e,endFrame:a.endFrame,startValue:0,endValue:lns.anim.drawings[a.drawingIndex].length})}}lns.ui.update()},this.applyOffset=function(){for(let e=0;e<lns.anim.layers.length;e++){const n=lns.anim.layers[e],t=lns.anim.drawings[n.drawingIndex];["x","y"].forEach(e=>{if(0!==e){for(let a=0;a<t.length;a++)t.points[a][e]+=n[e];n[e]=0}})}},this.pruneDrawings=function(){const e=[];for(let n=0;n<lns.anim.drawings.length;n++){lns.anim.drawings[n]&&e.push(n)}for(let n=0;n<lns.anim.layers.length;n++){const t=lns.anim.layers[n],a=e.indexOf(t.drawingIndex);t.drawingIndex=a}for(let e=lns.anim.drawings.length;e>=0;e--)null==lns.anim.drawings[e]&&lns.anim.drawings.splice(e,1)}}function Draw(e){const n=this;if(Object.defineProperty(this,"layer",{get:function(){return lns.anim.layers[lns.anim.layers.length-1]}}),Object.defineProperty(this,"drawing",{get:function(){return lns.anim.drawings[lns.anim.drawings.length-1]},set:function(e){lns.anim.drawings[lns.anim.drawings.length-1]=e}}),lns.anim.drawings.push(new Drawing),lns.anim.layers.push(new Layer({...e,drawingIndex:Math.max(lns.anim.drawings.length-1,0),startFrame:lns.anim.currentFrame})),this.setProperties=function(e,t){for(const a in e)void 0!==n.layer[a]&&(n.layer[a]=e[a],lns.ui.faces[a]&&lns.ui.faces[a].update(e[a],t))},this.setProperty=function(e,t){lns.anim.updateProperty(e,t),n.layer[e]=t},this.setDefaults=function(){n.setProperties(e)},this.reset=function(e){let t=!1;n.drawing?n.drawing.length>0&&(t=!0):t=!0,t&&(lns.anim.drawings.push(new Drawing),lns.ui.faces.color.addColor(n.layer.color),lns.anim.layers.push(new Layer({linesInterval:+lns.ui.faces.linesInterval.value,segmentNum:+lns.ui.faces.segmentNum.value,jiggleRange:+lns.ui.faces.jiggleRange.value,wiggleRange:+lns.ui.faces.wiggleRange.value,wiggleSpeed:+lns.ui.faces.wiggleSpeed.value,color:lns.ui.faces.color.value,drawingIndex:lns.anim.drawings.length-1,startFrame:+e||lns.anim.currentFrame})),lns.data.saveState()),lns.ui.update()},this.cutEnd=function(){let e=0;for(let n=0;n<lns.anim.layers.length-1;n++){const t=lns.anim.layers[n];t.endFrame>e&&(e=t.endFrame)}lns.draw.layer.endFrame>e&&(lns.draw.layer.endFrame=e)},this.hasDrawing=function(){return lns.anim.layers.some(e=>e.isInFrame(lns.anim.currentFrame)&&lns.anim.drawings[e.drawingIndex].length>0)},this.quickColorSelect=function(){const e=new UIModal("Select Color",lns,lns.mousePosition);e.add(new UIColor({callback:function(e){n.setProperty("color",e),lns.ui.faces.color.el.value=e}})),lns.ui.faces.color.colors.forEach(t=>{e.add(new UIButton({text:t,css:{background:t},value:t,callback:function(){n.setProperty("color",t),lns.ui.faces.color.el.value=t,e.clear()}}))})},this.randomColor=function(){const e="#"+Math.floor(16777215*Math.random()).toString(16);n.setProperty("color",e),lns.ui.faces.color.el.value=e},this.colorVariation=function(){let e=parseInt(n.layer.color.substr(1),16);e+=Cool.randomInt(-500,500),e=Math.max(0,e);const t="#"+e.toString(16);n.setProperty("color",t),lns.ui.faces.color.el.value=t},this.brush=0,this.brushSpread=1,this.startDots=!1,this.dots=10,this.grass=0,this.mouseTimer=performance.now(),this.mouseInterval=30,this.isDrawing=!1,lns.mousePosition=new Cool.Vector,this.outSideCanvas=function(e){e.toElement!=lns.canvas.canvas&&(n.isDrawing&&n.reset(),n.isDrawing=!1)},this.pop=function(){n.drawing.length>0&&("end"==n.drawing.pop()&&n.drawing.pop(),n.drawing.add("end"))},this.popOff=function(){if(n.drawing.length>0){n.drawing.pop();for(let e=n.drawing.length-1;e>=0&&"end"!=n.drawing.get(e);e--)n.drawing.pop()}},this.addBrush=function(e,t){const a=n.brush*n.brush*n.brushSpread;let s=1;n.grass>0&&(s*=n.grass);let i=new Cool.Vector(e,t);for(let l=0;l<n.brush;l++){let l=new Cool.Vector(e+Cool.randomInt(-a,a),t+Cool.randomInt(-a,a));for(;l.dist(i)>a;)l=new Cool.Vector(e+Cool.randomInt(-a,a),t+Cool.randomInt(-a,a));l.divide(lns.canvas.scale),l.x>0&&l.x<lns.canvas.width&&l.y>0&&l.y<lns.canvas.height&&n.drawing.add(l);const r=Cool.randomInt(1,3);for(let e=0;e<r;e++)l.x>0&&l.x<lns.canvas.width&&l.y>0&&l.y<lns.canvas.height&&n.drawing.add(new Cool.Vector(l.x+Cool.randomInt(-1,1),l.y+Cool.randomInt(s)));n.drawing.add("end")}},this.addLine=function(e,t){n.drawing.add(new Cool.Vector(e,t).divide(lns.canvas.scale))},this.update=function(e){performance.now()>n.mouseInterval+n.mouseTimer&&(n.mouseTimer=performance.now(),lns.mousePosition.x=e.pageX,lns.mousePosition.y=e.pageY,n.isDrawing&&(n.brush<=0?n.addLine(Math.round(e.offsetX),Math.round(e.offsetY)):n.addBrush(Math.round(e.offsetX),Math.round(e.offsetY))))},this.start=function(e){1!=e.which||lns.render.isPlaying||e.altKey?e.altKey&&(n.startDots=new Cool.Vector(Math.round(e.offsetX),Math.round(e.offsetY))):(n.isDrawing=!0,n.mouseTimer=performance.now(),n.brush<=0?n.addLine(Math.round(e.offsetX),Math.round(e.offsetY)):n.addBrush(Math.round(e.offsetX),Math.round(e.offsetY)))},this.end=function(e){if(n.startDots){const t=Math.abs(n.startDots.x-e.offsetX),a=Math.abs(n.startDots.y-e.offsetY),s=t/a,i=t/(s*n.dots/2),l=a/(1/s*n.dots/2);let[r,o]=n.startDots.x<e.offsetX?[n.startDots.x,e.offsetX]:[e.offsetX,n.startDots.x],[d,c]=n.startDots.y<e.offsetY?[n.startDots.y,e.offsetY]:[e.offsetY,n.startDots.y];for(let e=r;e<o;e+=i)for(let t=d;t<c;t+=l){const a=Math.round(e)+Cool.randomInt(-i/2,i/2),s=Math.round(t)+Cool.randomInt(-l/2,l/2),r=Cool.randomInt(1,3);for(let e=0;e<r;e++)n.drawing.add(new Cool.Vector(a+Cool.randomInt(-1,1),s+Cool.randomInt(-1,1)));n.drawing.add("end")}n.startDots=!1}else 1==e.which&&(n.isDrawing=!1,"end"!==n.drawing.get(-2)&&n.drawing.length>1?n.drawing.add("end"):n.drawing.pop())},window.navigator.platform.includes("iPad")){const e={which:1},a=window.devicePixelRatio;function t(n,t){if(n.preventDefault(),n.touches[0]){const s=n.target.getBoundingClientRect();e.offsetX=n.targetTouches[0].pageX-s.left/a,e.offsetY=n.targetTouches[0].pageY-s.top/a,e.which=1,t(e)}}lns.canvas.canvas.addEventListener("touchstart",e=>{t(e,n.start)}),lns.canvas.canvas.addEventListener("touchmove",e=>{t(e,n.update)}),lns.canvas.canvas.addEventListener("touchend",t=>{n.end(e)})}else window.PointerEvent?(lns.canvas.canvas.addEventListener("pointermove",n.update),lns.canvas.canvas.addEventListener("pointerdown",n.start),lns.canvas.canvas.addEventListener("pointerup",n.end)):(lns.canvas.canvas.addEventListener("mousemove",n.update),lns.canvas.canvas.addEventListener("mousedown",n.start),lns.canvas.canvas.addEventListener("mouseup",n.end));document.addEventListener("mousemove",n.outSideCanvas)}function Files(e,n){const t=this;this.saveFilesEnabled=!1,this.saveSettingsOnUnload=e.save||!1,this.fileName=void 0,this.saveFile=function(n,a){lns.draw.reset(),lns.ui.play.checkEnd(),lns.anim.drawings.pop(),lns.anim.layers.pop(),t.fileName=lns.ui.faces.title.value||prompt("Name this file:"),e.fit&&confirm("Fit canvas?")&&lns.canvas.fitCanvasToDrawing();const s={v:"2.5",w:+lns.canvas.width,h:+lns.canvas.height,fps:+lns.anim.fps,mc:[...new Set(lns.anim.layers.map(e=>e.color))].length>1};e.bg&&(s.bg=lns.canvas.bgColor),s.l=n?lns.anim.layers.filter(e=>e.isInFrame(lns.anim.currentFrame)).map(e=>(e.startFrame=0,e.endFrame=0,e.getSaveProps())):lns.anim.layers.map(e=>e.getSaveProps());const i=new Set(s.l.map(e=>e.d));s.d=[];for(let e=0;e<lns.anim.drawings.length;e++)s.d[e]=i.has(e)?lns.anim.drawings[e].points.map(e=>"end"==e?0:[Math.round(e.x),Math.round(e.y)]):null;if(Object.keys(lns.anim.states).length>1){s.s={};for(const e in lns.anim.states)"default"!=e&&(s.s[e]=[lns.anim.states[e].start,lns.anim.states[e].end])}const l=JSON.stringify(s);if(t.fileName){const e=new Blob([l],{type:"application/x-download;charset=utf-8"});saveAs(e,t.fileName+".json"),lns.ui.faces.title.value=t.fileName}},this.loadFile=function(e,n){t.fileName=e,t.fileName&&(".json"!=t.fileName.slice(t.fileName.length-5)&&(t.fileName+=".json"),fetch(t.fileName).then(e=>e.json()).then(e=>{t.loadJSON(e,n)}).catch(e=>{console.error(e)}))},this.loadJSON=function(e,t){lns.anim=new n(lns.canvas.ctx,lns.render.dps,!0),lns.anim.loadData(e,(function(){lns.canvas.setWidth(e.w),lns.canvas.setHeight(e.h),lns.ui.faces.fps.update(e.fps),e.bg&&lns.canvas.setBGColor(e.bg),lns.draw.reset(),t&&t(e)}))},this.reOpenFile=function(){t.saveFile({},(function(e){location.href+=`?src=/${prompt("Enter location:")}/${e}.json`}))},this.openFile=function(){const e=document.createElement("input");e.type="file",e.click(),e.onchange=function(){t.readFile(e.files,lns.ui.updateFIO)}},this.readFile=function(e,n){for(let a,s=0;a=e[s];s++){if(!a.type.match("application/json"))continue;const e=new FileReader;e.onload=function(e){t.fileName=a.name.split(".")[0],t.loadJSON(JSON.parse(e.target.result),n)},e.readAsText(a)}},window.File&&window.FileReader&&window.FileList&&window.Blob&&(t.saveFilesEnabled=!0,console.log("%c Save file enabled ","color:lightgreen;background:black;"),lns.canvas.canvas.addEventListener("dragover",(function(e){e.preventDefault()})),lns.canvas.canvas.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),t.readFile(e.dataTransfer.files,lns.ui.updateFIO)}))),window.addEventListener("beforeunload",(function(n){t.saveSettingsOnUnload&&lns.ui.settings.saveSettings(),e.reload&&(n.returnValue="Did you save dumbhole?")}))}function Render(e,n){const t=this;this.showStats=n,n&&(this.stats=new Stats,this.stats.dom.style.position="relative"),this.dps=e||30,this.interval=1e3/this.dps,this.timer=performance.now(),window.drawCount=0,this.onionSkinNum=0,this.onionSkinIsVisible=!1,this.setOnionSkin=function(e){t.onionSkinNum=+e,t.onionSkinIsVisible=+e>0},this.reset=function(){lns.anim.frame=0,lns.anim.isPlaying=!1,lns.canvas.ctx.miterLimit=1,lns.ui.update()},this.toggle=function(){lns.anim.isPlaying?lns.draw.layer.startFrame=lns.draw.layer.endFrame=lns.anim.currentFrame:(lns.ui.play.checkEnd(),lns.draw.reset()),lns.anim.isPlaying=!lns.anim.isPlaying,lns.ui.timeline.update()},this.setDps=function(e){t.dps=+e,t.interval=1e3/t.dps,lns.anim.dps=t.dps},this.setFps=function(e){lns.anim.fps=+e},this.clearCount=0,this.clearInterval=0,this.update=function(e){if(n&&t.stats.begin(),performance.now()>t.interval+t.timer||"cap"==e){if(t.timer=performance.now(),lns.anim.isPlaying&&lns.ui.timeline.update(),t.clearCount==t.clearInterval?(lns.canvas.ctx.clearRect(0,0,lns.canvas.width,lns.canvas.height),t.clearCount=0):t.clearCount++,lns.ui.capture.bg&&(lns.ui.capture.frames>0||lns.ui.capture.isVideo)&&(lns.canvas.ctx.fillStyle=lns.canvas.bgColor,lns.canvas.ctx.fillRect(0,0,lns.canvas.width,lns.canvas.height)),lns.bgImage.display(),t.onionSkinNum>0&&t.onionSkinIsVisible){const e=lns.anim.currentFrame;for(let n=1;n<=t.onionSkinNum;n++){const a=e-n;a>=0&&(lns.anim.currentFrame=a,lns.anim.overrideProperty("color",`rgba(105,150,255,${1.5-n/t.onionSkinNum})`),lns.anim.draw())}lns.anim.cancelOverride(),lns.anim.currentFrame=e}if(lns.anim.draw(),lns.anim.update(),window.drawCount++,lns.anim.layers.some(e=>e.isHighlighted)){for(let e=0,n=lns.anim.layers.length-1;e<n;e++){const n=lns.anim.layers[e];n.isInFrame(lns.anim.currentFrame)&&(n.isHighlighted?(lns.anim.overrideProperty("color","rgba(127,127,255,0.5)"),lns.anim.overrideProperty("jiggleRange",0),lns.anim.overrideProperty("wiggleRange",0),lns.anim.overrideProperty("segmentNum",1),lns.anim.overrideProperty("wiggleSpeed",0)):n.dontDraw=!0)}lns.anim.draw(5,5,!0),lns.anim.cancelOverride(),lns.anim.layers.filter(e=>e.dontDraw).forEach(e=>{e.dontDraw=!1})}}lns.ui.capture.isCapturing||window.requestAnimFrame(t.update),n&&t.stats.end()},this.start=function(){window.requestAnimFrame(t.update)}}const LayerMixin={toggle(){this.isToggled=!this.isToggled},isInFrame(e){return e>=this.startFrame&&e<=this.endFrame&&!this.dontDraw},addTween(e){this.tweens.push(e),e.startFrame<this.startFrame&&(this.startFrame=e.startFrame),e.endFrame>this.endFrame&&(this.endFrame=e.endFrame),"default"==lns.anim.stateName&&lns.anim.state.end<this.endFrame&&(lns.anim.state.end=this.endFrame)},resetTweens(){for(let e=0;e<this.tweens.length;e++){const n=this.tweens[e];n.startFrame<this.startFrame&&(n.startFrame=this.startFrame),n.endFrame>this.endFrame&&(n.endFrame=this.endFrame)}},addIndex(e){if(!this.isInFrame(e))if(this.startFrame-1==e)this.startFrame-=1;else{if(this.endFrame+1!=e)return new Layer({...this.getCloneProps(),startFrame:e,endFrame:e});this.endFrame+=1}return this},removeIndex(e,n){if(this.startFrame==e&&this.endFrame==e)n();else if(this.startFrame==e)this.startFrame+=1;else{if(this.endFrame!=e){if(e>this.startFrame&&e<this.endFrame){const n=new Layer(this.getCloneProps());return n.startFrame=e+1,n.endFrame=this.endFrame,n.resetTweens(),this.endFrame=e-1,this.resetTweens(),n}return this}this.endFrame-=1}this.resetTweens()},shiftIndex(e,n){return n||(n=-1),this.startFrame>=e&&(this.startFrame+=n),this.endFrame>=e&&(this.endFrame+=n),this.resetTweens(),this},getSaveProps(){const e={n:this.segmentNum,r:this.jiggleRange,w:this.wiggleRange,v:this.wiggleSpeed,ws:this.wiggleSegments,c:this.isToggled?this.tempColor:this.color,f:[this.startFrame,this.endFrame],d:this.drawingIndex};return this.x&&(e.x=this.x),this.y&&(e.y=this.y),this.tweens&&(e.t=this.tweens.map(e=>[e.prop,e.startFrame,e.endFrame,e.startValue,e.endValue])),this.order&&(e.o=this.order),e},getEditProps(){return{segmentNum:this.segmentNum,jiggleRange:this.jiggleRange,wiggleRange:this.wiggleRange,wiggleSpeed:this.wiggleSpeed,wiggleSegments:this.wiggleSegments,linesInterval:this.linesInterval,breaks:this.breaks,color:this.color}},getTweenProps(){return{segmentNum:this.segmentNum,jiggleRange:this.jiggleRange,wiggleRange:this.wiggleRange,wiggleSpeed:this.wiggleSpeed,wiggleSegments:this.wiggleSegments,linesInterval:this.linesInterval,startIndex:this.drawingStartIndex,endIndex:this.drawingEndIndex}},getCloneProps(){return props={drawingIndex:this.drawingIndex,segmentNum:this.segmentNum,jiggleRange:this.jiggleRange,wiggleRange:this.wiggleRange,wiggleSpeed:this.wiggleSpeed,wiggleSegments:this.wiggleSegments,breaks:this.breaks,linesInterval:this.linesInterval,x:this.x,y:this.y,color:this.color,drawingStartIndex:this.drawingStartIndex,drawingEndIndex:this.drawingEndIndex,startFrame:this.startFrame,endFrame:this.endFrame}}},LinesMixin={updateProperty(e,n){for(let t=0;t<this.layers.length-1;t++)this.layers[t].isToggled&&(this.layers[t][e]=n)},addLayer(e){-1==this.layers.indexOf(e)&&this.layers.splice(lns.anim.layers.length-1,0,e)},removeLayer(e){const n=this.layers.indexOf(e);n>=0&&this.layers.splice(n,1)}};class UILayer extends UICollection{constructor(e,n,t){super(e),this.addClass("layer"),this.layer=n;const a=e.width*(n.endFrame-n.startFrame+1);this.toggle=new UIToggle({type:"layer-toggle",text:""+n.drawingIndex,callback:e.callback}),this.highlight=new UIToggle({type:"layer-highlight",text:"❏",callback:function(){n.isHighlighted=!n.isHighlighted}}),this.edit=new UIButton({type:"layer-edit",text:"✎",callback:()=>{const e=new UIModal("Edit Layer",lns,this.position,()=>{lns.ui.update()});e.add(new UIButton({text:"Cut Segment",callback:()=>{const e=lns.anim.drawings[n.drawingIndex];e.pop(),e.pop(),e.add("end")}})),e.add(new UIButton({text:"Cut Line",callback:()=>{const e=lns.anim.drawings[n.drawingIndex];e.pop();for(let n=e.length-1;n>0&&"end"!=e[n];n--)e.pop()}})),e.add(new UIButton({text:"Clone",callback:()=>{const e=n.getCloneProps();e.startFrame=e.endFrame=n.endFrame+1,lns.anim.addLayer(new Layer(e)),lns.ui.play.setFrame(n.endFrame+1)}})),e.add(new UIButton({text:"Split",callback:()=>{const e=n.getCloneProps();e.startFrame=lns.anim.currentFrame+1,n.endFrame=lns.anim.currentFrame,lns.anim.addLayer(new Layer(e)),lns.ui.play.setFrame(n.endFrame+1)}})),e.addBreak("Start Frame:"),e.add(new UIBlur({value:n.startFrame,callback:function(e){n.startFrame=+e}})),e.addBreak("End Frame:"),e.add(new UIBlur({value:n.endFrame,callback:function(e){n.endFrame=+e}}))}}),this.tween=new UIButton({text:"⧉",type:"layer-tween",callback:()=>{const e={prop:"endIndex",startFrame:lns.anim.currentFrame,endFrame:lns.anim.currentFrame+10,startValue:0,endValue:"end"},t=new UIModal("Add Tween",lns,this.position,(function(){e.endValue=lns.anim.drawings[n.drawingIndex].length,n.addTween(e),lns.ui.update()}));t.addBreak("Property:"),t.add(new UISelect({options:Object.keys(n.getTweenProps()),value:"endIndex",selected:"endIndex",callback:function(n){e.prop=n}})),t.addBreak("Start Frame:"),t.add(new UIBlur({value:e.startFrame,callback:function(n){e.startFrame=+n}})),t.addBreak("End Frame:"),t.add(new UIBlur({value:e.endFrame,callback:function(n){e.endFrame=+n}})),t.addBreak("Start Value:"),t.add(new UIBlur({value:e.startValue,callback:function(n){e.startValue=+n}})),t.addBreak("End Value:"),t.add(new UIBlur({value:e.endValue,callback:function(n){e.endValue=+n}}))}}),this.remove=new UIButton({type:"remove",text:"X",callback:()=>{lns.anim.layers.splice(lns.anim.layers.indexOf(n),1),lns.ui.update()}}),this.left=new UIDragButton({text:"⬗",type:"left",callback:(e,t)=>{n.startFrame+=(e||-1)*(t||1),lns.ui.update()}}),this.leftRight=new UIButton({text:"⬖",type:"left-right",callback:()=>{n.endFrame==n.startFrame&&(n.endFrame+=1),n.startFrame+=1,lns.ui.update()}}),this.right=new UIDragButton({text:"⬖",type:"right",callback:(e,t)=>{n.endFrame+=(e||1)*(t||1),lns.ui.update()}}),this.rightLeft=new UIButton({text:"⬖",type:"right-left",callback:()=>{n.endFrame===n.startFrame&&(n.endFrame+=-1),n.endFrame+=-1,lns.ui.update()}}),this.moveUp=new UIButton({text:"^",type:"move-up",callback:e.moveUp}),n.startFrame>0&&this.append(this.left),a>70&&this.append(this.leftRight),this.append(this.toggle),a>30&&this.append(this.highlight),a>40&&this.append(this.edit),a>60&&this.append(this.tween),a>50&&this.append(this.remove),a>90&&t&&this.append(this.moveUp),a>80?(this.append(this.rightLeft),this.rightLeft.addClass("right-margin")):this.right.addClass("right-margin"),this.append(this.right)}get html(){return this.el}}class UITween extends UICollection{constructor(e,n,t){super(e),this.addClass("tween"),this.tween=n,this.edit=new UIButton({text:"✎",type:"tween-edit",callback:()=>{const e=new UIModal("Edit Tween",lns,this.position,(function(){lns.ui.update()}));e.addBreak("Start Frame:"),e.add(new UIBlur({value:n.startFrame,callback:function(e){n.startFrame=+e}})),e.addBreak("End Frame:"),e.add(new UIBlur({value:n.endFrame,callback:function(e){n.endFrame=+e}})),e.addBreak("Start Value:"),e.add(new UIBlur({value:n.startValue,callback:function(e){n.startValue=+e}})),e.addBreak("End Value:"),e.add(new UIBlur({value:n.endValue,callback:function(e){n.endValue=+e}}))}}),this.left=new UIDragButton({text:"⬗",type:"left",callback:(e,t)=>{n.startFrame+=(e||-1)*(t||1),lns.ui.update()}}),this.right=new UIDragButton({text:"⬖",type:"right",callback:(e,n)=>{this.tween.endFrame+=(e||1)*(n||1),lns.ui.update()}}),this.remove=new UIButton({type:"remove",text:"🗑",callback:()=>{t.tweens.splice(t.tweens.indexOf(this),1),lns.ui.update()}}),this.append(this.edit),this.append(this.remove),this.append(this.left),this.append(this.right)}get html(){return this.el}}function Capture(){const e=this;this.ready=!0,this.prev={f:void 0,n:0},this.frames=0,this.bg=!0,this.isCapturing=!1,this.isVideo=!1,this.videoLoops=0,this.one=function(){e.frames=1,e.start()},this.multiple=function(){e.frames=+prompt("Capture how many frames?"),e.start()},this.start=function(){lns.anim.onDraw=function(){e.frames>0?(e.capture(),e.frames--,e.isCapturing=!0):e.isCapturing&&(e.isCapturing=!1,lns.anim.isPlaying=!1,lns.anim.onDraw=void 0)}},this.cycle=function(){lns.draw.reset(),lns.anim.frame=lns.anim.endFrame,lns.anim.isPlaying=!0,e.frames=lns.anim.endFrame*Math.max(1,lns.render.dps/lns.anim.fps)+1,e.start()},this.capture=function(){if(lns.files.saveFilesEnabled)lns.canvas.canvas.toBlob(n=>{const t=lns.ui.faces.title.value,a=Cool.padNumber(lns.anim.currentFrame,3);a==e.prev.f?e.prev.n+=1:e.prev.n=0;let s=`${t}-${a}-${e.prev.n}.png`;e.prev.f=a,saveAs(n,s).onwriteend=function(){setTimeout(()=>{window.requestAnimFrame(()=>{lns.render.update("cap")})},100)}});else{const n=e.canvas.toDataURL("image/png").replace("image/png","image/octet-stream");window.location.href=n}},this.startVideo=function(){lns.anim.isPlaying=!1,lns.anim.frame=0,e.videoLoops=+prompt("Number of loops?"),lns.anim.onPlayedState=function(){e.videoLoops>1?e.videoLoops--:e.isVideo&&(e.video(),e.isVideo=!1,lns.anim.isPlaying=!1,lns.anim.onPlayedState=void 0)},e.isVideo=!0,e.bg=!0,e.video(),lns.anim.isPlaying=!0},this.video=function(){if(e.ready){e.ready=!1,e.isVideo=!0;const n=lns.canvas.canvas.captureStream(lns.render.dps);e.rec=new MediaRecorder(n,{videoBitsPerSecond:3145728}),e.rec.start(),e.rec.addEventListener("dataavailable",e=>{const n=new Blob([e.data],{type:"video/webm"}),t=URL.createObjectURL(n),a=document.createElement("a");document.body.appendChild(a),a.href=t,a.download=lns.ui.faces.title.value+".webm"||"lines.webm",a.click()})}else e.isVideo=!1,e.ready=!0,e.rec.stop()}}function Drawings(){const e=this;function n(e){const n=lns.anim.layers.filter((n,t)=>t<lns.anim.layers.length-1&&n.drawingIndex==e);if(n.length>0){for(let e=0;e<n.length;e++)if(n[e].isInFrame(lns.anim.currentFrame))return n[e];for(let e=0;e<n.length;e++)if(n[e].isInFrame(lns.anim.currentFrame+1)||n[e].isInFrame(lns.anim.currentFrame-1))return n[e];return n[0]}return!1}this.update=function(){e.panel.drawings.clear();for(let t=0;t<lns.anim.drawings.length-1;t++)if(lns.anim.drawings[t]){let a=n(t);e.panel.drawings.append(new UIToggle({text:t,isOn:!!a&&a.isInFrame(lns.anim.currentFrame),callback:function(){let e=n(t);if(this.isOn){if(e&&e.isInFrame(lns.anim.currentFrame)){const n=e.removeIndex(lns.anim.currentFrame,(function(){lns.anim.removeLayer(e)}));n&&lns.anim.addLayer(n)}}else if(console.log(e),e)if(e.isInFrame(lns.anim.currentFrame)||e.isInFrame(lns.anim.currentFrame-1)||e.isInFrame(lns.anim.currentFrame+1))e.addIndex(lns.anim.currentFrame);else{const n=e.getCloneProps();n.startFrame=n.endFrame=lns.anim.currentFrame,lns.anim.addLayer(new Layer(n))}else lns.anim.addLayer(new Layer({drawingIndex:t,linesInterval:+lns.ui.faces.linesInterval.value,segmentNum:+lns.ui.faces.segmentNum.value,jiggleRange:+lns.ui.faces.jiggleRange.value,wiggleRange:+lns.ui.faces.wiggleRange.value,wiggleSpeed:+lns.ui.faces.wiggleSpeed.value,color:lns.ui.faces.color.value,startFrame:lns.anim.currentFrame}));lns.ui.update()}}),t)}},this.clear=function(){e.panel.drawings.clear()}}function Palette(){const e=this;this.palettes={};let n=1;this.add=function(){lns.draw.reset();const n=e.current=prompt("Name this palette.");n&&(e.palettes[n]={color:lns.draw.layer.color,segmentNum:lns.draw.layer.segmentNum,jiggleRange:lns.draw.layer.jiggleRange,wiggleRange:lns.draw.layer.wiggleRange,wiggleSpeed:lns.draw.layer.wiggleSpeed,wiggleSegments:lns.draw.layer.wiggleSegments,lineWidth:lns.canvas.ctx.lineWidth,mouseInterval:lns.draw.mouseInterval,brush:lns.draw.brush,brushSpread:lns.draw.brushSpread,dots:lns.draw.dots,grass:lns.draw.grass},e.addUI(n))},this.addUI=function(t){e.panel.addRow(t);const a=new UIButton({text:t,callback:function(){e.load(t)}});e.panel.add(a);let s="+";n<10&&(lns.ui.keys[n]=a,s=n+"",n++);const i=new UIText({text:s,callback:function(e){console.log(lns.ui.keys[+e]),lns.ui.keys[+e].key.value="",lns.ui.keys[+e].key.el.placeholder="+",lns.ui.keys[+e]=a}});a.key=i,e.panel.add(i),e.panel.add(new UIButton({text:"✎",callback:function(){const n=prompt("Rename: ");e.palettes[n]=_.cloneDeep(e.palettes[t]),e.addUI(n),e.remove(t)}})),e.panel.add(new UIButton({text:"X",callback:function(){e.remove(t)}}))},this.remove=function(n){delete e.palettes[n],e.panel[n].clear()},this.setup=function(n){for(const t in n)"current"!=t&&(e.addUI(t),e.palettes[t]=n[t]);n.current&&e.load(n.current)},this.load=function(n){lns.draw.reset(),e.palettes.current=n;const t=e.palettes[n];for(prop in t)void 0!==lns.ui.faces[prop]&&lns.ui.faces[prop].update(t[prop])},this.buildFromAnimation=function(){for(let n=0;n<lns.anim.layers.length;n++){const t="Layer "+n,a=lns.anim.layers[n],s={color:a.color,segmentNum:a.segmentNum,jiggleRange:a.jiggleRange,wiggleRange:a.wiggleRange,wiggleSpeed:a.wiggleSpeed,wiggleSegments:a.wiggleSegments,breaks:a.breaks,lineWidth:lns.canvas.ctx.lineWidth,mouseInterval:lns.draw.mouseInterval,brush:0,brushSpread:lns.draw.brushSpread,dots:lns.draw.dots,grass:lns.draw.grass};let i=!1;for(const n in e.palettes){const t=e.palettes[n];let a=!0;for(const e in t)t[e]!=s[e]&&(a=!1);a&&(i=!0)}i||(e.palettes[t]=s,e.addUI(t))}},this.quickSelect=function(n){const t=new UIModal("Select Pallette",lns,lns.mousePosition);for(const n in e.palettes)"current"!=n&&t.add(new UIButton({text:n,callback:function(){e.load(n),t.clear()}}))},this.saveFile=function(){const n=JSON.stringify(e.palettes),t=prompt("Name:"),a=new Blob([n],{type:"application/x-download;charset=utf-8"});saveAs(a,t+".json")},this.loadFile=function(){const n=document.createElement("input");n.type="file",n.click(),console.log(n),n.onchange=function(){for(let t,a=0;t=n.files[a];a++){if(console.log(a,t),!t.type.match("application/json"))continue;const n=new FileReader;n.onload=function(n){console.log(n.target.result),e.setup(JSON.parse(n.target.result))},n.readAsText(t)}}}}function Play(){const e=this;this.setFrame=function(e){+e<=lns.anim.endFrame+1&&+e>=0&&(lns.anim.frame!=+e&&lns.draw.reset(),lns.anim.frame=+e,lns.draw.layer.startFrame=lns.anim.currentFrame,lns.draw.layer.endFrame=lns.anim.currentFrame,lns.ui.update())},this.checkEnd=function(){lns.anim.currentFrame!=lns.anim.endFrame||lns.draw.hasDrawing()||e.next(-1)},this.next=function(e){const n=lns.anim.currentFrame+e;lns.anim.isPlaying&&lns.ui.faces.play.update(),lns.draw.isDrawing=!1,lns.draw.drawing.length>0?(lns.draw.reset(n),lns.anim.frame=n):(e>0&&(lns.anim.currentFrame<lns.anim.state.end||"default"==lns.anim.stateName&&lns.draw.hasDrawing())&&(lns.draw.layer.startFrame=n,lns.draw.layer.endFrame=n,lns.anim.frame=n),e<0&&lns.anim.currentFrame>lns.anim.state.start&&(lns.draw.layer.startFrame=n,lns.draw.layer.endFrame=n,lns.anim.frame=n)),lns.data.saveState(),lns.ui.update()},this.plus=function(){e.setFrame(lns.anim.endFrame),e.next(1)}}function setupAnimateInterface(e){e.toggleRL=function(){this.isOn?lns.canvas.canvas.parentElement.classList.add("right"):lns.canvas.canvas.parentElement.classList.remove("right")},e.cursorToggle=function(){lns.canvas.canvas.classList.contains("no-cursor")?lns.canvas.canvas.classList.remove("no-cursor"):lns.canvas.canvas.classList.add("no-cursor")},e.baseFontSize=11,e.updateScale=function(n){e.baseFontSize=+n,document.body.style.setProperty("--base-font-size",e.baseFontSize)},e.updateFIO=function(n,t){e.faces.title.value=lns.files.fileName.split("/").pop().replace(".json",""),e.faces.fps.value=n.fps,document.title=e.faces.title.value+" ~ animate",e.faces.width.value=n.w,e.faces.height.value=n.h,lns.anim.layers.forEach(n=>{n&&(e.faces.color.addColor(n.color),e.faces.color.value=n.color)}),n.bg&&(e.faces.bgColor.value=n.bg),e.update()},e.update=function(){e.timeline.update(),e.drawings.update(),e.states.update()}}function States(){const e=this;this.update=function(){for(const n in lns.anim.states){const t=lns.anim.states[n],a=e.panel[n]?e.panel[n]:e.addUI(n,t,!1);for(const e in t)a[e].value!=t[e]&&(a[e].value=t[e])}},this.addUI=function(n,t,a){const s=e.panel.addRow(n);return lns.anim.states[n]=t,lns.ui.faces.stateSelector.addOption(n),e.panel.add(new UILabel({text:n}),s),e.panel.add(new UIBlur({text:"Start",value:t.start,callback:function(e){t.start=+e}}),s,"start"),e.panel.add(new UIBlur({text:"End",value:t.end,callback:function(e){t.end=+e}}),s,"end"),e.panel.add(new UIButton({text:"x",callback:function(){delete lns.anim.states[n],e.panel.removeRow(s),lns.ui.faces.stateSelector.removeOption(n),lns.anim.state="default",lns.ui.faces.stateSelector.value="default"}}),s),s},this.set=function(e){lns.anim.state=e,lns.ui.update()},this.create=function(){const n=prompt("Name?");e.addUI(n,{start:lns.anim.currentFrame,end:lns.anim.currentFrame},!0),lns.anim.state=n,lns.ui.faces.stateSelector.value=n}}function Timeline(){const e=this;this.frameWidth=40,this.autoFit=!1,this.viewLayers=!0,this.viewActiveLayers=!1,this.updateDuringPlay=!1,this.init=function(){e.panel.el.addEventListener("wheel",n=>{n.preventDefault(),e.frameWidth+=(n.deltaY>0?1:-1)*(n.altKey?20:1),e.panel.timeline.setProp("--frame-width",e.frameWidth)}),e.panel.el.addEventListener("mousedown",e=>{e.preventDefault()}),e.panel.el.addEventListener("mouseup",e=>{e.preventDefault()}),e.panel.el.addEventListener("mousemove",e=>{1==e.which&&e.target.classList.contains("frame")&&lns.anim.currentFrame!=+e.target.textContent?(lns.draw.reset(),lns.ui.play.setFrame(+e.target.textContent),lns.ui.update()):e.which}),e.panel.el.oncontextmenu=function(){return!1}},this.fit=function(){const n=lns.anim.endFrame+1,t=lns.ui.timeline.panel.el.clientWidth-11;e.frameWidth=(t-2*n)/n,e.panel.timeline.setProp("--frame-width",e.frameWidth),e.frameWidth<5?(e.panel.timeline.addClass("five"),e.panel.timeline.removeClass("ten")):e.frameWidth<10?(e.panel.timeline.addClass("ten"),e.panel.timeline.removeClass("five")):(e.panel.timeline.removeClass("ten"),e.panel.timeline.removeClass("five"))},this.fitFrame=function(){lns.ui.faces.timelineAutoFit.off(),e.autoFit=!1,e.frameWidth=120,e.panel.timeline.setProp("--frame-width",e.frameWidth),e.update(),e.scrollToFrame()},this.scrollToFrame=function(){e.panel.timeline.el.scrollTo(lns.ui.panels.timeline.timeline["frm-"+lns.anim.currentFrame].el.offsetLeft-10,0)},this.update=function(){lns.ui.faces.frameDisplay.value=lns.anim.currentFrame,e.panel.timeline.setProp("--num-frames",lns.anim.endFrame+1),e.panel.timeline.setProp("--num-tweens",lns.anim.layers.reduce((e,n)=>e+n.tweens.length,0)),e.panel.timeline.clear();const n=lns.anim.endFrame+1;for(let t=0;t<n;t++){const n=new UIButton({type:"frame",text:""+t,css:{gridColumnStart:1+2*t,gridColumnEnd:3+2*t},class:t==lns.anim.currentFrame?"current":"",callback:function(){lns.draw.reset(),lns.ui.play.setFrame(t),lns.ui.update()}});e.panel.timeline.append(n,"frm-"+t)}!e.updateDuringPlay&&lns.anim.isPlaying||this.drawLayers(),e.scrollToFrame()},this.drawLayers=function(){if(e.viewLayers){const n=e.viewActiveLayers?lns.anim.layers.filter(e=>e.isInFrame(lns.anim.currentFrame)):lns.anim.layers;e.panel.timeline.setProp("--num-layers",n.length-1);let t=2,a=3;for(let s=0;s<n.length-1;s++){const i=n[s];i.isToggled&&i.toggle();const l=new UILayer({type:"layer",width:e.frameWidth,css:{gridRowStart:t,gridRowEnd:a,gridColumnStart:2*i.startFrame+1,gridColumnEnd:2*i.endFrame+3},callback:function(){i.isToggled||lns.draw.setProperties(i.getEditProps(),!0),i.toggle()},moveUp:function(){const t=lns.anim.layers.indexOf(n[s-1]),a=lns.anim.layers.indexOf(i);t&&([lns.anim.layers[t],lns.anim.layers[a]]=[lns.anim.layers[a],lns.anim.layers[t]]),e.update()}},i,s>0&&n.length>2);t+=2,a+=2,e.panel.timeline.append(l,"layer-"+s);for(let n=0;n<i.tweens.length;n++){const l=i.tweens[n],r=new UITween({type:"tween",css:{gridRowStart:t,gridRowEnd:a,gridColumnStart:2*l.startFrame+1,gridColumnEnd:2*l.endFrame+3}},l,i);e.panel.timeline.append(r,`tween-${n}-layer-${s}`),t+=2,a+=2}}}else e.panel.timeline.setProp("--num-layers",0);e.autoFit&&e.fit()},this.toggleViewLayers=function(){e.viewLayers=!e.viewLayers,e.update()},this.toggleViewActiveLayers=function(){e.viewActiveLayers=!e.viewActiveLayers,e.update()},this.split=function(){for(let e=0,n=lns.anim.layers.length-1;e<n;e++){const n=lns.anim.layers[e];if(n.isInFrame(lns.anim.currentFrame)){const e=n.getCloneProps();e.startFrame=lns.anim.currentFrame+1,lns.anim.addLayer(new Layer(e)),n.endFrame=lns.anim.currentFrame}}lns.ui.play.setFrame(lns.anim.currentFrame+1)},this.select=function(){const n=lns.anim.layers.filter(e=>e.isInFrame(lns.anim.currentFrame));n.pop(),n.filter(e=>!e.isToggled).forEach((n,t)=>{e.panel.timeline["layer-"+t].toggle.handler()})},this.selectAll=function(){const n=lns.anim.layers.filter(e=>e.isToggled).length==lns.anim.layers.length-1;for(let t=0,a=lns.anim.layers.length-1;t<a;t++){const a=lns.anim.layers[t];n&&a.isToggled?(e.panel.timeline["layer-"+t].toggle.on(),lns.anim.layers[t].toggle()):a.isToggled||(lns.anim.layers[t].toggle(),e.panel.timeline["layer-"+t].toggle.off())}}}function appSave(){return{canvasColor:lns.canvas.bgColor,lineWidth:lns.canvas.ctx.lineWidth,color:lns.draw.layer.color,width:lns.canvas.width,height:lns.canvas.height,fps:lns.anim.fps,dps:lns.render.dps,onionSkinIsVisible:lns.render.onionSkinIsVisible,onionSkinNum:lns.render.onionSkinNum,mouseInterval:lns.draw.mouseInterval,palettes:lns.ui.palette.palettes,rl:lns.ui.faces.rl.value,viewLayers:lns.ui.faces.viewLayers.value,viewActiveLayers:lns.ui.faces.viewActiveLayers.value,timelineAutoFit:lns.ui.faces.timelineAutoFit.value,canvasScale:lns.ui.faces.canvasScale.value,interfaceScale:lns.ui.faces.interfaceScale.value,quickRefScale:lns.ui.faces.quickRefScale.value,quickRefList:lns.ui.panels.quickRef.list}}function appLoad(e){lns.ui.faces.dps.update(e.dps),lns.ui.faces.onionSkinNum.update(e.onionSkinNum),lns.ui.faces.mouseInterval.update(e.mouseInterval),lns.ui.faces.width.update(e.width),lns.ui.faces.height.update(e.height),lns.ui.faces.bgColor.update(e.canvasColor),lns.ui.faces.viewLayers.update(e.viewLayers),lns.ui.faces.viewActiveLayers.update(e.viewActiveLayers),lns.ui.faces.timelineAutoFit.update(e.timelineAutoFit),lns.ui.faces.canvasScale.update(e.canvasScale),lns.ui.faces.interfaceScale.update(e.interfaceScale),lns.ui.faces.quickRefScale.update(e.quickRefScale),e.quickRefList.forEach(e=>{lns.ui.createUI(e,e.mod,e.sub,lns.ui.panels.quickRef)}),lns.ui.panels.quickRef.list=e.quickRefList,lns.ui.faces.lineWidth.update(e.lineWidth),lns.ui.faces.fps.update(e.fps),lns.ui.faces.color.update(e.color),lns.ui.palette.setup(e.palettes),lns.ui.faces.rl.update(e.rl)}window.addEventListener("load",(function(){window.lns={},Object.assign(Layer.prototype,LayerMixin),Object.assign(Lines.prototype,LinesMixin);const e={};location.search.substr(1).split("&").map(n=>{let[t,a]=n.split("=");e[t]=a});const n="pixel"===e.render?PixelLines:Lines;lns.canvas=new Canvas("lines",512,512,"#ffffff",!0),lns.render=new Render(30,!0),lns.anim=new n(lns.canvas.ctx,30,!0),lns.draw=new Draw({linesInterval:5,segmentNum:2,jiggleRange:1,wiggleRange:1,wiggleSpeed:.1,color:"#000000"}),lns.bgImage=new Background,lns.data=new Data,lns.files=new Files({fit:!1,save:!1,load:!0,reload:!1,bg:!1},n),lns.ui=new Interface(lns),lns.ui.capture=new Capture,lns.ui.states=new States,lns.ui.palette=new Palette,lns.ui.drawings=new Drawings,lns.ui.play=new Play,lns.ui.timeline=new Timeline,setupAnimateInterface(lns.ui),lns.ui.settings=new Settings(lns,"lns",appSave),lns.ui.load("./interface/interface.json",(function(){lns.draw.setDefaults(),lns.ui.settings.load(appLoad),e.src&&lns.files.loadFile(e.src.split(".")[0],lns.ui.updateFIO),lns.ui.update(),lns.render.start(),lns.ui.timeline.init(),lns.render.showStats&&lns.ui.panels.play.el.appendChild(lns.render.stats.dom)}))}));
//# sourceMappingURL=src_maps/animate.min.js.map
