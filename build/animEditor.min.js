class Clip{constructor(t){this.name=t.name,this.filePath=t.filePath,this.animation=t.animation,this.startFrame=t.startFrame,this.endFrame=t.startFrame+t.animation.endFrame,this.isVisible=!0,this.state="default",this.animation.isPlaying=!0}update(t){this.animation.frame=t-this.startFrame}draw(){this.animation.update(),this.animation.draw()}get data(){return{name:this.name,filePath:this.filePath,startFrame:this.startFrame,isVisible:this.isVisible,state:this.state}}}class Composition{constructor(t){this.tracks=[],t.tracks?t.tracks.forEach((t=>{this.tracks.push(new Track(t))})):this.tracks.push(new Track({})),this.activeTrackIndex=t.activeTrackIndex||0,this.isVisible=void 0===t.isVisible||t.isVisible}addTrack(){this.tracks.push(new Track)}get track(){return this.tracks[this.activeTrackIndex]}set track(t){this.activeTrackIndex=+t}get endFrame(){}update(t){for(let e=0;e<this.tracks.length;e++)this.tracks[e].update(t)}draw(t){for(let e=0;e<this.tracks.length;e++)this.tracks[e].draw(t)}get data(){return{tracks:this.tracks.map((t=>t.data)),activeTrackIndex:this.activeTrackIndex,isVisible:this.isVisible}}}class Track{constructor(t){this.clips=[],t.clips&&t.clips.forEach((t=>{this.addClip(t)}))}get endFrame(){}addClip(t){this.clips.push(new Clip(t))}update(t){for(let e=0;e<this.clips.length;e++){const i=this.clips[e];if(!(t<i.startFrame)&&!(t>i.endFrame)){i.update(t);break}}}draw(t){for(let e=0;e<this.clips.length;e++){const i=this.clips[e];if(!(t<i.startFrame)&&!(t>i.endFrame)){i.draw(t);break}}}get data(){return{clips:this.clips.map((t=>t.data))}}}function Canvas(t,e){Object.assign(Canvas.prototype,ModuleMixin);const i=this;this.canvas=document.getElementById(e.id),this.ctx=this.canvas.getContext("2d");let s=e.checkRetina&&window.devicePixelRatio||1,n=e.lineWidth||1,a=e.scale||1,o=this.canvas.width,c=this.canvas.height;this.addProp("scale",{get:()=>a,set:t=>{a=+t,i.updateSize()}}),this.addProp("width",{get:()=>o,set:t=>{o=+t,i.updateSize()}}),this.addProp("height",{get:()=>c,set:t=>{c=+t,i.updateSize()}}),this.addProp("lineWidth",{get:()=>n,set:t=>{n=+t,i.reset()}}),this.updateSize=function(){i.canvas.width=o*s*a,i.canvas.height=c*s*a,i.reset()},this.reset=function(){i.canvas.style.width=o*a+"px",i.canvas.style.height=c*a+"px",i.ctx.lineWidth=n,i.ctx.miterLimit=1,i.ctx.lineCap="round",i.ctx.lineJoin="round"}}function Compositions(t){Object.assign(Compositions.prototype,ModuleMixin);const e=this,i={default:new Composition({})};this.addProp("data",{get:()=>{const t={};for(const e in i)t[e]=i[e].data;return t}}),this.addComposition=function(t,e){i[t]=new Composition(e||{})},this.load=function(t){for(const i in t)e.addComposition(i,t[i])},this.get=function(t){return i[t]}}function FileIO(t,e){Object.assign(FileIO.prototype,ModuleMixin);const i=this;let s=e.projectName||"Animation_"+(new Date).toDateString().replace(/ /g,"-");function n(e){t.footage.load(e.footage,!0,(()=>{!function(e){for(const i in e)for(let s=0;s<e[i].tracks.length;s++){const n=e[i].tracks[s];for(let a=0;a<n.clips.length;a++){const o=n.clips[a];e[i].tracks[s].clips[a].animation=t.footage.get(o.name)}}t.compositions.load(e)}(e.compositions)}))}this.addProp("projectName",{get:()=>s,set:t=>{s=t,document.title=s+" ~ animation editor"}}),this.save=function(){const e={v:"0.1"};e.footage=t.footage.filePaths,e.compositions=t.compositions.data;const i=JSON.stringify(e),n=new Blob([i],{type:"application/x-download;charset=utf-8"});saveAs(n,s+".json")},this.load=function(t){console.log(t),i.projectName=t.split("/").pop().replace(".json",""),fetch(t).then((t=>t.json())).then((t=>{n(t)})).catch((t=>{console.error("err",t.message)}))}}function Footage(t){const e=this;let i=!0;const s={};function n(n,a,o,c){s[a]=new Lines(t.canvas.ctx,30,!0),s[a].loadData(n,(()=>{(c||i&&confirm("Set project settings?"))&&(i=!1,t.ui.faces.width.update(n.w),t.ui.faces.height.update(n.h))}));const r=new UIButton({text:a,callback:()=>{const e=new Clip({filePath:o,name:a,animation:s[a],startFrame:t.renderer.frame});t.timeline.addClip(e)}});e.panel.footageRow.append(r),e.filePaths.push(o)}this.filePaths=[],this.load=function(t,e,i){t.forEach((t=>{const s=t.split("/").pop().replace(".json","");fetch(t).then((t=>t.json())).then((a=>{n(a,s,t,e),i&&i()})).catch((t=>{console.error("err",t.message)}))}))},this.openFile=function(){const t=document.createElement("input");t.type="file",t.multiple=!0,t.click(),t.onchange=function(){let e=prompt("Directory?","/drawings/");!function(t,e){for(let i,s=0;i=t[s];s++){if(!i.type.match("application/json"))continue;const t=new FileReader;t.onload=function(t){const s=e+i.name,a=i.name.split(".")[0];n(JSON.parse(t.target.result),a,s)},t.readAsText(i)}}(t.files,e)}},this.get=function(t){return s[t]}}const ModuleMixin={addProp(t,e){Object.defineProperty(this,t,{get:e.get,set:e.set})}};function Renderer(t,e,i){Object.assign(Renderer.prototype,ModuleMixin);const s=this;e||(e=30),i||(i=e);let n=1e3/e,a=performance.now(),o=Math.round(e/i),c=0,r=!1,d=0;window.drawCount=0,this.isPlaying=!1,this.addProp("dps",{get:()=>e,set:t=>{n=1e3/(e=+t),o=Math.round(e/i)}}),this.addProp("fps",{get:()=>i,set:t=>{i=+t,o=Math.round(e/i)}}),this.addProp("frame",{get:()=>d,set:e=>{console.log("frame",e);let i=d;i="+1"===e?d+1:"-1"===e?d-1:"end"===e?t.timeline.endFrame:+e,i<=t.timeline.endFrame&&i>=0&&(d=i),t.ui.faces.frameDisplay.value=d}}),this.addProp("isPlaying",{get:()=>r,set:t=>{r=t}}),this.update=function(e,i){(performance.now()>n+a||i)&&(a=performance.now(),t.canvas.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),r&&(c===o?(d++,c=0):c++),t.timeline.update(d),t.timeline.draw(),window.drawCount++),i||window.requestAnimFrame(s.update)},this.start=function(){window.requestAnimFrame(s.update)}}function Timeline(t){Object.assign(Timeline.prototype,ModuleMixin);const e=this,i="default";this.addProp("composition",{get:()=>t.compositions.get(i),set:t=>{i=t}}),this.addClip=function(t){console.log(e.composition),e.composition.track.addClip(t)},this.update=function(t){e.composition.update(t)},this.draw=function(){e.composition.draw()}}window.addEventListener("load",(function(){const t={};t.addProp=Object.defineProperty;const e={};location.search.substr(1).split("&").map((t=>{let[i,s]=t.split("=");e[i]=s})),t.canvas=new Canvas(t,{id:"lines",checkRetina:!0}),t.timeline=new Timeline(t),t.compositions=new Compositions(t),t.footage=new Footage(t),t.fio=new FileIO(t,{}),t.renderer=new Renderer(t),t.ui=new Interface(t),t.ui.settings=new Settings(t,"anim-editor"),t.ui.load("./interface/interface.json",(()=>{e.src&&t.fio.load(e.src),t.ui.settings.load(),t.renderer.start()})),console.log(t)}));
//# sourceMappingURL=src_maps/animEditor.min.js.map
